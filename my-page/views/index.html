<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeanEngine Demo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .info-card {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #4CAF50;
        }
        .api-section {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .api-endpoint {
            font-family: 'Courier New', monospace;
            background: #2d3748;
            color: #e2e8f0;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .method {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: bold;
            margin-right: 10px;
        }
        .method.get { background: #48bb78; color: white; }
        .method.post { background: #4299e1; color: white; }
        .method.put { background: #ed8936; color: white; }
        .method.delete { background: #f56565; color: white; }
        .test-button {
            background: #4299e1;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #3182ce;
        }
        #result {
            background: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 LeanEngine Demo</h1>
        
        <div class="info-card">
            <h3>应用信息</h3>
            <p><strong>应用名称:</strong> <%= appName %></p>
            <p><strong>当前时间:</strong> <%= currentTime %></p>
            <p><strong>状态:</strong> 🟢 运行中</p>
        </div>

        <div class="api-section">
            <h3>📡 API 端点测试</h3>
            
            <h4>云函数</h4>
            <div class="api-endpoint">
                <span class="method post">POST</span> /1.1/functions/hello
            </div>
            <button class="test-button" onclick="testCloudFunction('hello')">测试 Hello 函数</button>
            
            <div class="api-endpoint">
                <span class="method post">POST</span> /1.1/functions/add
            </div>
            <button class="test-button" onclick="testAddFunction()">测试 Add 函数</button>
            
            <div class="api-endpoint">
                <span class="method post">POST</span> /1.1/functions/getTodoStats
            </div>
            <button class="test-button" onclick="testCloudFunction('getTodoStats')">获取 Todo 统计</button>

            <h4>登录记录云函数</h4>
            <div class="api-endpoint">
                <span class="method post">POST</span> /1.1/functions/recordUserLogin
            </div>
            <button class="test-button" onclick="testRecordLogin()">记录用户登录</button>
            
            <div class="api-endpoint">
                <span class="method post">POST</span> /1.1/functions/getUserLoginHistory
            </div>
            <button class="test-button" onclick="testGetLoginHistory()">获取登录历史</button>
            
            <div class="api-endpoint">
                <span class="method post">POST</span> /1.1/functions/getLoginStats
            </div>
            <button class="test-button" onclick="testCloudFunction('getLoginStats')">获取登录统计</button>

            <h4>REST API</h4>
            <div class="api-endpoint">
                <span class="method get">GET</span> /todos
            </div>
            <button class="test-button" onclick="testAPI('GET', '/todos')">获取 Todo 列表</button>
            
            <div class="api-endpoint">
                <span class="method post">POST</span> /todos
            </div>
            <button class="test-button" onclick="testCreateTodo()">创建 Todo</button>
            
            <h4>登录记录 API</h4>
            <div class="api-endpoint">
                <span class="method post">POST</span> /login-records/login
            </div>
            <button class="test-button" onclick="testLoginRecord()">模拟用户登录</button>
            
            <div class="api-endpoint">
                <span class="method get">GET</span> /login-records/records
            </div>
            <button class="test-button" onclick="testAPI('GET', '/login-records/records')">获取登录记录</button>
            
            <div class="api-endpoint">
                <span class="method get">GET</span> /login-records/stats
            </div>
            <button class="test-button" onclick="testAPI('GET', '/login-records/stats')">登录统计</button>
            
            <div class="api-endpoint">
                <span class="method get">GET</span> /health
            </div>
            <button class="test-button" onclick="testAPI('GET', '/health')">健康检查</button>
        </div>

        <div id="result-section" style="margin-top: 30px;">
            <h3>📋 测试结果</h3>
            <div id="result">点击上方按钮测试 API...</div>
        </div>
    </div>

    <script>
        function updateResult(content) {
            document.getElementById('result').textContent = content;
        }

        async function testAPI(method, url, body = null) {
            try {
                updateResult('🔄 发送请求...');
                
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };
                
                if (body) {
                    options.body = JSON.stringify(body);
                }
                
                const response = await fetch(url, options);
                const data = await response.json();
                
                updateResult(`✅ ${method} ${url}\n状态: ${response.status}\n响应:\n${JSON.stringify(data, null, 2)}`);
            } catch (error) {
                updateResult(`❌ 请求失败:\n${error.message}`);
            }
        }

        async function testCloudFunction(functionName, params = {}) {
            try {
                updateResult('🔄 调用云函数...');
                
                const response = await fetch(`/1.1/functions/${functionName}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(params)
                });
                
                const data = await response.json();
                
                updateResult(`✅ 云函数 ${functionName}\n状态: ${response.status}\n响应:\n${JSON.stringify(data, null, 2)}`);
            } catch (error) {
                updateResult(`❌ 云函数调用失败:\n${error.message}`);
            }
        }

        function testAddFunction() {
            const a = Math.floor(Math.random() * 100);
            const b = Math.floor(Math.random() * 100);
            testCloudFunction('add', { a: a, b: b });
        }

        function testCreateTodo() {
            const title = `测试 Todo ${new Date().toLocaleTimeString()}`;
            testAPI('POST', '/todos', { title: title, completed: false });
        }

        // 登录记录相关测试函数
        function testRecordLogin() {
            const username = `user_${Math.floor(Math.random() * 1000)}`;
            testCloudFunction('recordUserLogin', {
                username: username,
                userAgent: navigator.userAgent,
                deviceInfo: 'Web Browser Test'
            });
        }

        function testGetLoginHistory() {
            const username = 'user_123'; // 可以改为具体用户名
            testCloudFunction('getUserLoginHistory', {
                username: username,
                limit: 10
            });
        }

        function testLoginRecord() {
            const username = `testuser_${Math.floor(Math.random() * 1000)}`;
            testAPI('POST', '/login-records/login', {
                username: username,
                deviceInfo: 'Web Browser Test'
            });
        }
    </script>
</body>
</html>